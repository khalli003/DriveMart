<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Управление Водителями</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
<div class="container">
  <h1>Управление Водителями</h1>

  <form id="driverForm">
    <div class="form-group">
      <label for="name">Имя Водителя</label>
      <input type="text" class="form-control" id="name" required>
    </div>
    <div class="form-group">
      <label for="licenseNumber">Номер Лицензии</label>
      <input type="text" class="form-control" id="licenseNumber" required>
    </div>
    <div class="form-group">
      <label for="companyId">ID Компании</label>
      <input type="number" class="form-control" id="companyId" required>
    </div>
    <div class="form-group">
      <label for="balance">Баланс</label>
      <input type="number" class="form-control" id="balance" value="0" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="carNumber">Номер Авто</label>
      <input type="text" class="form-control" id="carNumber" required>
    </div>
    <div class="form-group">
      <label for="carBrand">Марка Машины</label>
      <input type="text" class="form-control" id="carBrand" required>
    </div>
    <div class="form-group">
      <label for="carModel">Модель Машины</label>
      <input type="text" class="form-control" id="carModel" required>
    </div>
    <div class="form-group">
      <label for="carColor">Цвет</label>
      <input type="text" class="form-control" id="carColor" required>
    </div>
    <div class="form-group">
      <label for="driverAge">Возраст Водителя</label>
      <input type="number" class="form-control" id="driverAge" required>
    </div>
    <button type="submit" class="btn btn-primary">Добавить Водителя</button>
  </form>

  <h2>Список Водителей</h2>
  <table class="table table-bordered" id="driverTable">
    <thead>
    <tr>
      <th>ID</th>
      <th>Имя</th>
      <th>Номер Лицензии</th>
      <th>ID Компании</th>
      <th>Баланс</th>
      <th>Номер Авто</th>
      <th>Марка Машины</th>
      <th>Модель Машины</th>
      <th>Цвет</th>
      <th>Возраст</th>
      <th>Действия</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const apiUrl = '/drivers';

  // Функция для отображения водителей
  function fetchDrivers() {
    fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
              const tableBody = document.getElementById('driverTable').getElementsByTagName('tbody')[0];
              tableBody.innerHTML = ''; // Очищаем таблицу
              data.forEach(driver => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                        <td>${driver.id}</td>
                        <td>${driver.name}</td>
                        <td>${driver.licenseNumber}</td>
                        <td>${driver.company ? driver.company.id : 'Нет компании'}</td>
                        <td>${driver.balance}</td>
                        <td>${driver.carNumber}</td>
                        <td>${driver.carBrand}</td>
                        <td>${driver.carModel}</td>
                        <td>${driver.carColor}</td>
                        <td>${driver.driverAge}</td>
                        <td>
                            <button onclick="deleteDriver(${driver.id})" class="btn btn-danger">Удалить</button>
                            <button onclick="updateDriver(${driver.id})" class="btn btn-info">Редактировать</button>
                        </td>
                    `;
              });
            });
  }

  // Функция для добавления водителя
  document.getElementById('driverForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const newDriver = {
      name: document.getElementById('name').value,
      licenseNumber: document.getElementById('licenseNumber').value,
      company: { id: parseInt(document.getElementById('companyId').value) },
      balance: parseFloat(document.getElementById('balance').value),
      carNumber: document.getElementById('carNumber').value,
      carBrand: document.getElementById('carBrand').value,
      carModel: document.getElementById('carModel').value,
      carColor: document.getElementById('carColor').value,
      driverAge: parseInt(document.getElementById('driverAge').value)
    };

    fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(newDriver)
    })
            .then(response => response.json())
            .then(() => {
              document.getElementById('driverForm').reset(); // Очистить форму
              fetchDrivers(); // Обновить список водителей
            });
  });

  // Функция для удаления водителя
  function deleteDriver(id) {
    fetch(`${apiUrl}/${id}`, {
      method: 'DELETE'
    })
            .then(() => {
              fetchDrivers(); // Обновить список водителей после удаления
            });
  }

  // Функция для обновления водителя
  function updateDriver(id) {
    const name = prompt('Введите новое имя:', '');
    const licenseNumber = prompt('Введите новый номер лицензии:', '');
    const balance = prompt('Введите новый баланс:', '');
    const carNumber = prompt('Введите новый номер авто:', '');
    const carBrand = prompt('Введите новую марку машины:', '');
    const carModel = prompt('Введите новую модель машины:', '');
    const carColor = prompt('Введите новый цвет:', '');
    const driverAge = prompt('Введите новый возраст:', '');

    if (name && licenseNumber && balance && carNumber && carBrand && carModel && carColor && driverAge) {
      const updatedDriver = {
        name: name,
        licenseNumber: licenseNumber,
        balance: parseFloat(balance),
        carNumber: carNumber,
        carBrand: carBrand,
        carModel: carModel,
        carColor: carColor,
        driverAge: parseInt(driverAge)
      };

      fetch(`${apiUrl}/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedDriver)
      })
              .then(() => {
                fetchDrivers(); // Обновить список водителей после обновления
              });
    }
  }

  // Инициализация
  fetchDrivers();
</script>
</body>
</html>
